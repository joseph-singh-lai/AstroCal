<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Astronomy Explorer - Interactive astronomy events, satellite imagery, and sky map for La Brea, Trinidad & Tobago">
    <title>Astronomy Explorer - La Brea, Trinidad & Tobago</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Leaflet CSS for GIBS map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script>
        // NASA API Configuration (inlined to avoid MIME type issues on Vercel)
        window.NASA_API_CONFIG = {
            apiKey: 'X2dVwncjWkOz6OrVnWpO16W5eWE6NaAXz3BHH67Q',
            baseUrl: 'https://api.nasa.gov',
            
            // Cache settings (in milliseconds)
            cacheSettings: {
                apod: 24 * 60 * 60 * 1000,      // 24 hours (APOD is daily)
                donki: 6 * 60 * 60 * 1000,      // 6 hours (solar events update frequently)
                eonet: 12 * 60 * 60 * 1000,     // 12 hours (natural events)
            },
            
            // Date ranges for fetching events
            dateRanges: {
                donki: {
                    startDate: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 30 days ago
                    endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]   // 30 days ahead
                },
                eonet: {
                    days: 30 // Last 30 days
                }
            }
        };
        
        // Also expose as const for backward compatibility
        const NASA_API_CONFIG = window.NASA_API_CONFIG;
        
        // Astronomy API Configuration
        window.ASTRONOMY_API_CONFIG = {
            appId: '95875ee4-2471-4b8e-970f-4d11d9ce0ea7',
            appSecret: '7d3127a493c01e1484bc248b1b20ea4bc93b42c7efcfda31cff18cd782529855976fc03aa34088efff1d05aa87e10b3a0b33ba48ac1b1dd813ae1a323f00659429d3b48b3cf74ff30ed9d9b2b413d7575fc3d60e7f1124980249dc0815c2e5acf709ed3e029e94c8333b729aeca88daa',
            baseUrl: 'https://api.astronomyapi.com/api/v2',
            // Cache settings (in milliseconds)
            cacheSettings: {
                events: 6 * 60 * 60 * 1000,      // 6 hours
                positions: 1 * 60 * 60 * 1000,   // 1 hour (planet positions change slowly)
                skyMap: 30 * 60 * 1000           // 30 minutes
            }
        };
        
        // Also expose as const for backward compatibility
        const ASTRONOMY_API_CONFIG = window.ASTRONOMY_API_CONFIG;
    </script>
</head>
<body>
    <div id="app">
        <header class="main-header">
            <div class="header-content">
                <h1>Astronomy Explorer</h1>
                <p class="location-subtitle">La Brea, Trinidad & Tobago</p>
            </div>
            <nav class="main-nav">
                <button class="nav-button active" data-section="events">üìÖ Events</button>
                <button class="nav-button" data-section="gibs">üõ∞Ô∏è Satellite Imagery</button>
                <button class="nav-button" data-section="sky">‚≠ê Sky Map</button>
            </nav>
        </header>

        <main class="main-content">
            <!-- Events Section -->
            <section id="events-section" class="content-section active">
            <section class="controls-section">
                <div class="search-container">
                    <input 
                        type="text" 
                        id="searchInput" 
                        class="search-input" 
                        placeholder="Search events..."
                        aria-label="Search events"
                    >
                </div>

                <div class="location-container">
                    <div class="location-info">
                        <div class="location-status-wrapper">
                            <span id="locationStatus" class="location-status">üìç Using default location: La Brea, Trinidad & Tobago</span>
                            <span class="location-privacy">Your location is only used locally and never shared with external services.</span>
                        </div>
                        <div class="location-buttons">
                            <button id="locationButton" class="location-button" aria-label="Request location access">
                                üìç Use My Location
                            </button>
                            <button id="clearLocationButton" class="location-button location-button-secondary" aria-label="Clear saved location" style="display: none;">
                                üîÑ Reset
                            </button>
                        </div>
                    </div>
                </div>

                <aside class="filter-panel">
                    <h2>Filter by Category</h2>
                    <div class="filter-options">
                        <label class="filter-checkbox">
                            <input type="checkbox" value="meteor" checked>
                            <span>Meteor Showers (Annual peaks)</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" value="planet" checked>
                            <span>Planet Visibility (Oppositions & conjunctions)</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" value="iss" checked>
                            <span>ISS Passes (Real-time predictions)</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" value="workshop" checked>
                            <span>Workshops (Educational events)</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" value="apod" checked>
                            <span>NASA APOD (Daily astronomy image)</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" value="solar" checked>
                            <span>Solar Events (Flares & CMEs)</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" value="natural" checked>
                            <span>Natural Events (Fireballs & aurora)</span>
                        </label>
                        <label class="filter-checkbox">
                            <input type="checkbox" value="astronomy" checked>
                            <span>Astronomy API (Moon phases & planet positions)</span>
                        </label>
                    </div>
                    <button id="applyFilters" class="apply-button">Apply Filters</button>
                    <button id="refreshNASA" class="apply-button" style="margin-top: 0.5rem; background-color: var(--accent-secondary);">
                        üîÑ Refresh NASA Data
                    </button>
                </aside>
            </section>

            <section class="events-section">
                <div id="eventsContainer" class="events-container" role="list">
                    <!-- Events will be dynamically rendered here -->
                </div>
            </section>

            <section id="eventDetail" class="event-detail-section" aria-live="polite">
                <!-- Event details will be populated dynamically -->
            </section>
            </section>

            <!-- GIBS Satellite Imagery Section -->
            <section id="gibs-section" class="content-section">
                <div class="section-header">
                    <h2>üõ∞Ô∏è NASA Satellite Imagery Explorer</h2>
                    <p class="section-description">Explore Earth using NASA's Global Imagery Browse Services (GIBS)</p>
                </div>
                
                <div class="map-controls">
                    <div class="layer-controls">
                        <label for="layerSelect">Satellite Layer:</label>
                        <select id="layerSelect" class="layer-select">
                            <option value="osm">OpenStreetMap (Default)</option>
                            <option value="blueMarble">Blue Marble (Day) - NASA GIBS</option>
                            <option value="blueMarbleNight">Night Lights (2020) - NASA GIBS</option>
                            <option value="modisTerra">MODIS Terra True Color - NASA GIBS</option>
                            <option value="modisAqua">MODIS Aqua True Color - NASA GIBS</option>
                            <option value="fires">Active Fires - NASA GIBS</option>
                            <option value="aerosol">Aerosol Index - NASA GIBS</option>
                        </select>
                    </div>
                    <button id="centerMapButton" class="map-button">üìç Center on My Location</button>
                    <button id="centerDefaultButton" class="map-button">üìç Center on La Brea</button>
                </div>
                
                <div id="gibsMap" class="map-container"></div>
                <div class="map-info">
                    <p>Pan and zoom to explore satellite imagery. Use the layer selector to switch between different views.</p>
                </div>
            </section>

            <!-- Interactive Sky Map Section -->
            <section id="sky-section" class="content-section">
                <div class="section-header">
                    <h2>‚≠ê Interactive Sky Map</h2>
                    <p class="section-description">Explore the night sky over your location</p>
                </div>
                
                <div class="sky-controls">
                    <div class="sky-control-group">
                        <label for="skyTimeSelect">View Time:</label>
                        <input type="datetime-local" id="skyTimeSelect" class="sky-input">
                        <button id="useCurrentTime" class="sky-button">Now</button>
                    </div>
                    <div class="sky-control-group">
                        <label>
                            <input type="checkbox" id="showConstellations" checked>
                            Show Constellations
                        </label>
                        <label>
                            <input type="checkbox" id="showPlanets" checked>
                            Show Planets
                        </label>
                        <label>
                            <input type="checkbox" id="showStars" checked>
                            Show Stars
                        </label>
                    </div>
                    <button id="centerSkyMapButton" class="sky-button">üìç Use My Location</button>
                </div>
                
                <div id="skyMap" class="sky-map-container">
                    <canvas id="skyCanvas"></canvas>
                    <div id="skyInfo" class="sky-info">
                        <p>Click on objects in the sky map to learn more</p>
                    </div>
                </div>
                
                <div class="sky-legend">
                    <h3>Visible Events</h3>
                    <div id="visibleEvents" class="visible-events-list">
                        <!-- Will be populated with events visible at current time -->
                    </div>
                </div>
            </section>
        </main>

        <footer class="main-footer">
            <p>Astronomy Events ‚Äì La Brea, Trinidad & Tobago</p>
            <p class="footer-credit">Built with vanilla JavaScript, HTML, and CSS</p>
        </footer>
    </div>

    <!-- Leaflet JS for GIBS map -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="script.js"></script>
    <script src="gibs-map.js"></script>
    <script src="sky-map.js"></script>
</body>
</html>

